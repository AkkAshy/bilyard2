{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/akkanat/Projects/byiyard/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\nimport { withAccelerate } from \"@prisma/extension-accelerate\";\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: ReturnType<typeof createPrismaClient> | undefined;\n};\n\nfunction createPrismaClient() {\n  return new PrismaClient().$extends(withAccelerate());\n}\n\nexport const prisma = globalForPrisma.prisma ?? createPrismaClient();\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,kBAAkB;AAIxB,SAAS;IACP,OAAO,IAAI,sMAAY,GAAG,QAAQ,CAAC,IAAA,wLAAc;AACnD;AAEO,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///Users/akkanat/Projects/byiyard/src/lib/auth.ts"],"sourcesContent":["import NextAuth from \"next-auth\";\nimport Credentials from \"next-auth/providers/credentials\";\nimport bcrypt from \"bcryptjs\";\nimport { prisma } from \"./prisma\";\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  providers: [\n    Credentials({\n      name: \"credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" },\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          return null;\n        }\n\n        const user = await prisma.user.findUnique({\n          where: { email: credentials.email as string },\n        });\n\n        if (!user) {\n          return null;\n        }\n\n        const isPasswordValid = await bcrypt.compare(\n          credentials.password as string,\n          user.password\n        );\n\n        if (!isPasswordValid) {\n          return null;\n        }\n\n        return {\n          id: user.id,\n          email: user.email,\n          name: user.name,\n        };\n      },\n    }),\n  ],\n  session: {\n    strategy: \"jwt\",\n  },\n  pages: {\n    signIn: \"/login\",\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        token.id = user.id;\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      if (session.user) {\n        session.user.id = token.id as string;\n      }\n      return session;\n    },\n  },\n});\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;AACA;AACA;;;;;AAEO,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,IAAA,kKAAQ,EAAC;IAC1D,WAAW;QACT,IAAA,uKAAW,EAAC;YACV,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,OAAO;gBACT;gBAEA,MAAM,OAAO,MAAM,gIAAM,CAAC,IAAI,CAAC,UAAU,CAAC;oBACxC,OAAO;wBAAE,OAAO,YAAY,KAAK;oBAAW;gBAC9C;gBAEA,IAAI,CAAC,MAAM;oBACT,OAAO;gBACT;gBAEA,MAAM,kBAAkB,MAAM,8IAAM,CAAC,OAAO,CAC1C,YAAY,QAAQ,EACpB,KAAK,QAAQ;gBAGf,IAAI,CAAC,iBAAiB;oBACpB,OAAO;gBACT;gBAEA,OAAO;oBACL,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,MAAM,KAAK,IAAI;gBACjB;YACF;QACF;KACD;IACD,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;YACpB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;YAC5B;YACA,OAAO;QACT;IACF;AACF"}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///Users/akkanat/Projects/byiyard/src/app/api/tables/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/lib/prisma\";\nimport { auth } from \"@/lib/auth\";\n\n// GET /api/tables - получить все столы с активными сессиями\nexport async function GET() {\n  try {\n    const session = await auth();\n    if (!session) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const tables = await prisma.billiardTable.findMany({\n      where: { isActive: true },\n      include: {\n        sessions: {\n          where: { status: \"ACTIVE\" },\n          orderBy: { startedAt: \"desc\" },\n          take: 1,\n        },\n      },\n      orderBy: { id: \"asc\" },\n    });\n\n    const tablesWithSessions = tables.map((table) => ({\n      id: table.id,\n      name: table.name,\n      description: table.description,\n      espIpAddress: table.espIpAddress,\n      gpioPin: table.gpioPin,\n      hourlyRate: table.hourlyRate,\n      isActive: table.isActive,\n      activeSession: table.sessions[0]\n        ? {\n            id: table.sessions[0].id,\n            startedAt: table.sessions[0].startedAt,\n            duration: table.sessions[0].duration,\n            hourlyRate: table.sessions[0].hourlyRate,\n            status: table.sessions[0].status,\n          }\n        : null,\n    }));\n\n    return NextResponse.json(tablesWithSessions);\n  } catch (error) {\n    console.error(\"Error fetching tables:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n\n// POST /api/tables - создать новый стол\nexport async function POST(request: NextRequest) {\n  try {\n    const session = await auth();\n    if (!session) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n\n    const body = await request.json();\n    const { name, description, espIpAddress, gpioPin, hourlyRate } = body;\n\n    if (!name || !espIpAddress) {\n      return NextResponse.json(\n        { error: \"Name and ESP IP address are required\" },\n        { status: 400 }\n      );\n    }\n\n    // Получаем цену по умолчанию из настроек\n    const settings = await prisma.settings.findUnique({\n      where: { id: \"default\" },\n    });\n    const defaultRate = settings?.defaultHourlyRate || 130000;\n\n    const table = await prisma.billiardTable.create({\n      data: {\n        name,\n        description,\n        espIpAddress,\n        gpioPin: gpioPin || 2,\n        hourlyRate: hourlyRate || defaultRate,\n      },\n    });\n\n    return NextResponse.json(table, { status: 201 });\n  } catch (error) {\n    console.error(\"Error creating table:\", error);\n    return NextResponse.json(\n      { error: \"Internal server error\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,4HAAI;QAC1B,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,SAAS,MAAM,gIAAM,CAAC,aAAa,CAAC,QAAQ,CAAC;YACjD,OAAO;gBAAE,UAAU;YAAK;YACxB,SAAS;gBACP,UAAU;oBACR,OAAO;wBAAE,QAAQ;oBAAS;oBAC1B,SAAS;wBAAE,WAAW;oBAAO;oBAC7B,MAAM;gBACR;YACF;YACA,SAAS;gBAAE,IAAI;YAAM;QACvB;QAEA,MAAM,qBAAqB,OAAO,GAAG,CAAC,CAAC,QAAU,CAAC;gBAChD,IAAI,MAAM,EAAE;gBACZ,MAAM,MAAM,IAAI;gBAChB,aAAa,MAAM,WAAW;gBAC9B,cAAc,MAAM,YAAY;gBAChC,SAAS,MAAM,OAAO;gBACtB,YAAY,MAAM,UAAU;gBAC5B,UAAU,MAAM,QAAQ;gBACxB,eAAe,MAAM,QAAQ,CAAC,EAAE,GAC5B;oBACE,IAAI,MAAM,QAAQ,CAAC,EAAE,CAAC,EAAE;oBACxB,WAAW,MAAM,QAAQ,CAAC,EAAE,CAAC,SAAS;oBACtC,UAAU,MAAM,QAAQ,CAAC,EAAE,CAAC,QAAQ;oBACpC,YAAY,MAAM,QAAQ,CAAC,EAAE,CAAC,UAAU;oBACxC,QAAQ,MAAM,QAAQ,CAAC,EAAE,CAAC,MAAM;gBAClC,IACA;YACN,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,4HAAI;QAC1B,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,WAAW,EAAE,YAAY,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG;QAEjE,IAAI,CAAC,QAAQ,CAAC,cAAc;YAC1B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuC,GAChD;gBAAE,QAAQ;YAAI;QAElB;QAEA,yCAAyC;QACzC,MAAM,WAAW,MAAM,gIAAM,CAAC,QAAQ,CAAC,UAAU,CAAC;YAChD,OAAO;gBAAE,IAAI;YAAU;QACzB;QACA,MAAM,cAAc,UAAU,qBAAqB;QAEnD,MAAM,QAAQ,MAAM,gIAAM,CAAC,aAAa,CAAC,MAAM,CAAC;YAC9C,MAAM;gBACJ;gBACA;gBACA;gBACA,SAAS,WAAW;gBACpB,YAAY,cAAc;YAC5B;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,OAAO;YAAE,QAAQ;QAAI;IAChD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}